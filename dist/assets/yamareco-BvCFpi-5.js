import{l as j,V as B,f as E,T as f,X as g,M as O,d as D,c as _,C as w,P as A,I,F as L,S,a as Z,b as F,G as N,t as z,g as V,e as q}from"./index-BYzSYGK_.js";j.install("G-R6WHYV43J7");const h="./share/",r={lon:138.727412,lat:35.360601,zoom:12};for(const t in r)r[t]=localStorage.getItem(t)??r[t];for(const t of location.search.slice(1).split("&")){const e=t.split("=");e[0]in r&&(r[e[0]]=Number(e[1]))}const a=new B({center:E([r.lon,r.lat]),maxZoom:18,minZoom:5,constrainResolution:!0,zoom:r.zoom}),v=['<a href="https://maps.gsi.go.jp/development/ichiran.html">地理院タイル</a>'],G=new f({source:new g({attributions:v,url:"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png"}),title:"標準",type:"base"}),Y=new f({source:new g({attributions:v,url:"https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png"}),title:"淡色",type:"base",visible:!1}),$=new f({source:new g({attributions:v,url:"https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg"}),title:"写真",type:"base",visible:!1}),X=new f({source:new g({attributions:['&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors, ','&copy; <a href="https://opentopomap.org/">OpenTopoMap</a> ','(<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'],url:"https://tile.opentopomap.org/{z}/{x}/{y}.png"}),title:"OTM",type:"base",visible:!1}),l=new O({target:"map",layers:[G,Y,$,X],view:a,controls:D().extend([new _,new w({element:document.getElementById("toolbar")}),new w({element:document.getElementById("crosshair")}),new w({element:document.getElementById("searchbar")})])}),d=new A;l.addOverlay(d);const J=[new I({src:"./icon/952015.png",declutterMode:"none"}),new I({src:"./icon/902032.png",declutterMode:"none"})],R=[new L({color:"blue"}),new L({color:"yellow"})],H=[new S({color:"white",width:2}),new S({color:"gray",width:2})],U="14px sans-serif";function C(t){let e=t.indexOf("（");return e<0&&(e=t.indexOf("　")),e>0?t.slice(0,e):t}function W(t){const e=t.get("c")<4?0:1;return new V({image:J[e],text:new q({text:C(t.get("name")),font:U,fill:R[e],stroke:H[e],textAlign:"left",offsetX:12,offsetY:3}),zIndex:t.get("alt")})}const p=[];for(const t of document.querySelectorAll("input.tb-sanmei")){const e=t.value;p[e]=new Z({source:new F({url:h+"db_poi.php?cat="+e,format:new N}),title:"山名",style:W,declutter:!0,visible:t.checked}),l.addLayer(p[e]),t.addEventListener("change",function(){const n=this.value,s=this.checked;p[n].setVisible(s),n&2&&p[n^4].setVisible(!s),d.isOpened()&&d.hide()},{passive:!0})}function K(t){const e=document.getElementById(t),n=a.getMaxZoom(),s=a.getMinZoom();for(let o=0;o<=n-s;o++){const i=document.createElement("option");e.appendChild(i).textContent=n-o}e.selectedIndex=n-a.getZoom(),e.addEventListener("change",function(){a.setZoom(this.options[this.selectedIndex].value)},{passive:!0}),l.on("moveend",function(){const o=n-a.getZoom();e.selectedIndex!=o&&(e.selectedIndex=o)})}function Q(t){const e=document.getElementById(t),n=l.getLayers().getArray().filter(s=>s.get("type")=="base");for(const s of n){const o=document.createElement("option");o.selected=s.getVisible(),o.textContent=s.get("title"),e.appendChild(o)}e.addEventListener("change",function(){n.forEach((s,o)=>s.setVisible(o==this.selectedIndex))})}K("tb-zoom");Q("tb-base");window.toggle=function(t){const e=document.getElementById(t);e.style.display!="none"?e.style.display="none":e.style.display="block"};window.switchElement=function(t,e){const n=document.getElementById(t);n.style.display=e?"block":"none"};function ee(t){const e=parseInt(t*3600+.5);return[parseInt(e/3600),parseInt(e%3600/60),e%60]}function x(t){return(Number(t[2])/60+Number(t[1]))/60+Number(t[0])}function te(t){return String(t).match(/^(\d+)(\d\d)(\d\d)$/).slice(1)}function k(t){return x(te(t))}function ne(t){const e=("0"+t[1]).slice(-2),n=("0"+t[2]).slice(-2);return t[0]+"°"+e+"′"+n+"″"}function u(t){return ne(ee(t))}function oe(t){let e=t.match(/^(\d+)[,\s]\s*(\d+)$/);return e?[k(e[2]),k(e[1])]:(e=t.match(/^(\d+\.\d*)[,\s]\s*(\d+\.\d*)$/),e?[Number(e[2]),Number(e[1])]:(e=t.match(/^(\d+)°(\d+)′(\d+(\.\d*)?)″[,\s]\s*(\d+)°(\d+)′(\d+(\.\d*)?)″$/)||t.match(/^(\d+)度(\d+)分(\d+(\.\d*)?)秒[,\s]\s*(\d+)度(\d+)分(\d+(\.\d*)?)秒$/),e?[x(e.slice(5,8)),x(e.slice(1,4))]:null))}function se(t){const e=z(t),n=e[0].toFixed(6),s=e[1].toFixed(6),o={lon:u(e[0]),lat:u(e[1])},i=[],y="https://cyberjapandata2.gsi.go.jp/general/dem/scripts/getelevation.php";i.push(new Promise(b=>fetch(y+"?outtype=JSON&lon="+n+"&lat="+s).then(c=>c.json()).then(function(c){o.alt=parseInt(c.elevation+.5),b()}))),i.push(new Promise(b=>fetch(h+"db_poi.php?rgc=1&lon="+n+"&lat="+s).then(c=>c.json()).then(function(c){o.address=c.length?c.map(T=>T.name):"unknown",b()}))),Promise.all(i).then(()=>{d.show(t,"<h2>現在地</h2><table><tbody><tr><td>標高</td><td>"+o.alt+"m<tr><td>緯度</td><td>"+o.lat+"</td></tr><tr><td>経度</td><td>"+o.lon+"</td></tr><tr><td>所在</td><td>"+o.address.join("<br>")+"</td></tr></tbody></table>")})}window.openPopupCenter=()=>{se(a.getCenter())};const re=document.getElementById("result"),P=document.getElementById("count"),m=document.getElementById("items");function ie(t){for(;m.firstChild;)m.removeChild(m.firstChild);P.textContent="検索中",re.style.display="block",fetch(h+"db_poi.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"q="+encodeURIComponent(t)}).then(e=>e.json()).then(function(e){P.textContent=e.geo.length+"件";for(const n of e.geo){const s=document.createElement("tr");let o=document.createElement("td");o.addEventListener("click",()=>{M(n.id,0,!0)}),s.appendChild(o).textContent=n.id,o=document.createElement("td");const i=document.createElement("ruby"),y=document.createElement("rt");i.textContent=n.name,s.appendChild(o).appendChild(i).appendChild(y).textContent=C(n.kana),o=document.createElement("td"),m.appendChild(s).appendChild(o).textContent=n.alt}})}function M(t,e,n){fetch(h+"db_poi.php?id="+t+"&c="+e).then(s=>s.json()).then(function(s){const o=s.geo[0],i=E([o.lon,o.lat]);d.show(i,"<h2>"+o.name+"</h2><table><tbody><tr><td>よみ</td><td>"+C(o.kana)+"</td></tr><tr><td>標高</td><td>"+o.alt+"m</td></tr><tr><td>緯度</td><td>"+u(o.lat)+"</td></tr><tr><td>経度</td><td>"+u(o.lon)+"</td></tr><tr><td>所在</td><td>"+o.address.join("<br>")+"</td></tr><tr><td>"+(e<4?"PTID":"ID")+"</td><td>"+(e<4?'<a href="https://yamare.co/i'+o.id+'">'+o.id+"</a>":o.id)+"</td></tr></tbody></table>"),n&&a.setCenter(i)})}document.forms.form1.addEventListener("submit",function(t){const e=t.target.elements.query.value,n=oe(e);n?a.setCenter(E(n)):ie(e),t.preventDefault()},!1);l.on("click",function(t){l.forEachFeatureAtPixel(t.pixel,function(e,n){return e.getGeometry().getType()!=="Point"?!1:(M(e.getId(),e.get("c"),!1),!0)})});l.on("pointermove",function(t){if(t.dragging)return;const e=l.forEachFeatureAtPixel(l.getEventPixel(t.originalEvent),(n,s)=>n.getGeometry().getType()==="Point");l.getTargetElement().style.cursor=e?"pointer":""});window.addEventListener("DOMContentLoaded",function(){for(const t of document.querySelectorAll("button.navi"))window.opener?(t.innerHTML='<span class="one">✖︎</span>',t.addEventListener("click",()=>window.close())):history.length>1?(t.innerText="戻る",t.addEventListener("click",()=>history.back())):(t.innerText="TOP",t.addEventListener("click",()=>location.assign(".")))});window.addEventListener("load",function(t){const e=document.createElement("img");e.setAttribute("src","lime/lime.cgi?yamareco"),e.setAttribute("width",1),e.setAttribute("height",1);const n=document.querySelector(".navi");n.parentNode.insertBefore(e,n)});window.addEventListener("beforeunload",function(t){const e=z(a.getCenter());r.lon=e[0].toFixed(6),r.lat=e[1].toFixed(6),r.zoom=a.getZoom();for(const n in r)localStorage.setItem(n,r[n])});
