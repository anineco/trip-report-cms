import{l as A,V as R,f as w,T as _,X as I,I as B,F as V,S as Y,a as X,b as q,G as J,P as K,M as H,d as W,c as Q,t as N,e as ee,g as te}from"./index-BYzSYGK_.js";import{C as ne,T as oe,f as m,a as ae}from"./toolbar-o_ukZz47.js";import{S as le}from"./searchbar-BHFz5KXB.js";A.install("G-R6WHYV43J7");const f="./share/",s={lon:138.727412,lat:35.360601,zoom:12};for(const t in s)s[t]=localStorage.getItem(t)??s[t];for(const t of location.search.slice(1).split("&")){const e=t.split("=");e[0]in s&&(s[e[0]]=Number(e[1]))}const z=[13,13,12,11,10,9,8,8];function M(t){return t>=13?0:t<=8?6:14-t}let g=M(s.zoom)<<3;const i=new R({center:w([Number(s.lon),Number(s.lat)]),maxZoom:18,minZoom:5,constrainResolution:!0,zoom:s.zoom}),P=['<a href="https://maps.gsi.go.jp/development/ichiran.html">地理院タイル</a>'],se=new _({source:new I({attributions:P,url:"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png"}),title:"標準",type:"base"}),ce=new _({source:new I({attributions:P,url:"https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png"}),title:"淡色",type:"base",visible:!1}),re=new _({source:new I({attributions:P,url:"https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg"}),title:"写真",type:"base",visible:!1}),ie=new _({source:new I({attributions:['&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors, ','&copy; <a href="https://opentopomap.org/">OpenTopoMap</a> ','(<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'],url:"https://tile.opentopomap.org/{z}/{x}/{y}.png"}),title:"OTM",type:"base",visible:!1}),F=new B({src:"./icon/902029.png",declutterMode:"none"}),E=new B({src:"./icon/902030.png",declutterMode:"none"}),ue=new B({src:"./icon/902031.png",declutterMode:"none"}),de=[F,F,ue,E,E,E,E,E],me="14px sans-serif",pe=new V({color:"blue"}),fe=new Y({color:"white",width:2}),ye="left",ge=-4,he=16,ve="declutter";function be(t){const e=t.get("p");if(e<g)return null;const n=de[e&7],a=new ee({font:me,fill:pe,stroke:fe,textAlign:ye,offsetX:ge,offsetY:he,declutterMode:ve,text:t.get("name")});return new te({image:n,text:a,zIndex:e&-8})}const v=new X({source:new q({url:f+"db.php?cat=0&v=0",format:new J}),title:"山名",style:be,declutter:!0}),O=new ne({element:document.getElementById("centercross")}),c=new oe({element:document.getElementById("toolbar")}),Ee=new le({element:document.getElementById("searchbar")}),D=new K({autoPan:!1}),y=new H({target:"map",layers:[se,ce,re,ie,v],view:i,controls:W().extend([new Q,O,c,Ee]),overlays:[D]}),r={passive:!0},we=document.getElementById("menu2");c.setToggleButton("tb_menu2",we);c.setPopup(D);c.setCenterButton("tb_center");c.setBaseSelect("tb_base");c.setZoomSelect("tb_zoom",t=>{i.setZoom(t),g=M(t)<<3,v.getSource().changed()});c.setCreditButton("tb_help","mountain/help.html");c.setLayerCheckbox("tb_sanmei",v);c.setControlCheckbox("tb_cross",O);const o=document.forms.panel.elements,b=document.getElementById("tb_curr");b.value=0;function j(t){b.value=t.id,o.name.value=t.name,o.kana.value=t.kana,o.alt.value=t.alt,o.auth.value=t.auth,o.y.value=t.y,o.x.value=t.x,o.lat.value=t.lat,o.lon.value=t.lon;for(let e=0;e<3;e++)e<t.alias.length?(o[`name${e}`].value=t.alias[e].name,o[`kana${e}`].value=t.alias[e].kana):(o[`name${e}`].value="",o[`kana${e}`].value="")}function xe(){const t={id:b.value,name:o.name.value||"未設定",kana:o.kana.value,alt:o.alt.value,auth:o.auth.value,y:o.y.value,x:o.x.value,lat:o.lat.value,lon:o.lon.value},e=Array(3);for(let n=0;n<3;n++)e[n]={name:o[`name${n}`].value,kana:o[`kana${n}`].value};return t.alias=e.filter(n=>n.name&&n.kana),t}function Z(t,e,n){fetch(f+"db.php?id="+t).then(a=>a.json()).then(function(a){const l=a.geo[0],u=Number(l.lon),d=Number(l.lat);l.x=m(u),l.y=m(d),j(l);const p=w([u,d]);e&&i.setCenter(p),n&&c.openPopupName(p,l);const S=l.level&-8;g>S&&(g=S,i.setZoom(z[S>>3]),v.getSource().changed())})}function $(t){const e=b.value;fetch(f+"db.php?id="+e+"&n="+t).then(n=>n.json()).then(function(n){const a=n.geo[0];if(a.id!=e){const l=Number(a.lon),u=Number(a.lat);a.x=m(l),a.y=m(u),j(a);const d=w([l,u]);i.setCenter(d);const p=a.level&-8;g>p&&(i.setZoom(z[p>>3]),g=p,v.getSource().changed()),h.style.display=="none"&&c.openPopupName(d,a)}})}document.getElementById("tb_prev").addEventListener("click",function(t){$(t.shiftKey?-2:-1)},r);document.getElementById("tb_next").addEventListener("click",function(t){$(t.shiftKey?2:1)},r);const k=document.getElementById("menu3"),h=document.getElementById("menu4");document.getElementById("tb_login").addEventListener("click",function(t){if(k.style.display!=="none"){k.style.display="none";return}if(h.style.display!=="none"){fetch(f+"logout.php").then(e=>e.text()).then(function(e){e==="SUCCESS"&&(o.token.value="",alert("ログアウトしました")),h.style.display="none"});return}k.style.display="block"},r);document.forms.login.addEventListener("submit",function(t){fetch(f+"login.php",{method:"POST",body:new FormData(t.target)}).then(e=>e.json()).then(function(e){e.status==="SUCCESS"?(o.token.value=e.token,alert("ログイン成功"),k.style.display="none",h.style.display="block",c.closePopup()):(o.token.value="",alert("ログイン失敗"))}),t.preventDefault()});function G(){const t=N(i.getCenter());o.lat.value=t[1],o.lon.value=t[0],o.y.value=m(t[1]),o.x.value=m(t[0]);const e=t[0].toFixed(6),n=t[1].toFixed(6);fetch("https://cyberjapandata2.gsi.go.jp/general/dem/scripts/getelevation.php?outtype=JSON&lon="+e+"&lat="+n).then(a=>a.json()).then(function(a){o.alt.value=typeof a.elevation=="number"?Math.round(a.elevation+.5):-9999})}document.getElementById("tb_new").addEventListener("click",function(t){b.value=0,o.name.value="",o.kana.value="";for(let e=0;e<3;e++)o[`name${e}`].value="",o[`kana${e}`].value="";G()},r);document.getElementById("tb_read").addEventListener("click",G,r);document.getElementById("tb_disp").addEventListener("click",function(t){if(o.lon.value&&o.lat.value){const e=w([Number(o.lon.value),Number(o.lat.value)]),n=xe();n.address=[],c.openPopupName(e,n)}else alert("位置が未指定")},r);document.forms.panel.addEventListener("submit",function(t){const e=new FormData(t.target);e.set("id",b.value),fetch(f+"db.php",{method:"POST",body:e}).then(n=>n.json()).then(function(n){alert("登録完了");const a=n.geo[0];a.y=m(a.lat),a.x=m(a.lon),j(a),c.closePopup(),v.getSource().refresh()}),t.preventDefault()});const L=document.getElementById("result");document.getElementById("tb_result").addEventListener("click",function(t){L.style.display=L.style.display!="none"?"none":"block"});const T=document.getElementById("count"),x=document.getElementById("items");let U;function ke(t){for(;x.firstChild;)x.removeChild(x.firstChild);T.textContent="検索中",L.style.display="block",fetch(f+"db.php?q="+encodeURIComponent(t)).then(e=>e.json()).then(function(e){U=e,T.textContent=e.geo.length+"件";for(const n of e.geo){const a=document.createElement("tr");let l=document.createElement("td");l.textContent=n.id,l.addEventListener("click",function(p){Z(this.textContent,!0,h.style.display=="none")},r),a.appendChild(l),l=document.createElement("td");const u=document.createElement("ruby");u.textContent=n.name;const d=document.createElement("rt");d.textContent=n.kana,a.appendChild(l).appendChild(u).appendChild(d),l=document.createElement("td"),l.textContent=n.alt,x.appendChild(a).appendChild(l)}})}document.forms.form1.addEventListener("submit",function(t){const e=t.target.elements.query.value,n=ae(e);n?i.setCenter(w(n)):ke(e),t.preventDefault()});document.forms.form2.addEventListener("submit",function(t){const e=(t.target.elements.bom.checked?"\uFEFF":"")+`ID,山名,よみ,標高,緯度,経度,備考
`+U.geo.map(l=>[l.id,l.name,l.kana,l.alt,l.lat,l.lon,""].join()).join(`
`)+`
`,n=new Blob([e],{type:"text/csv;charset=UTF-8"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download="result.csv",a.click(),t.preventDefault()});y.on("click",function(t){y.forEachFeatureAtPixel(t.pixel,function(e,n){return e.getGeometry().getType()!=="Point"?!1:(Z(e.getId(),!1,h.style.display=="none"),!0)})},r);y.on("pointermove",function(t){if(t.dragging)return;const e=y.forEachFeatureAtPixel(y.getEventPixel(t.originalEvent),(n,a)=>n.getGeometry().getType()==="Point");y.getTargetElement().style.cursor=e?"pointer":""},r);const C=document.getElementById("tb_exit");window.addEventListener("DOMContentLoaded",function(t){let e,n;window.opener?(e="✖︎",n=()=>window.close()):history.length>1?(e="戻る",n=()=>history.back()):(e="TOP",n=()=>location.assign(".")),C.innerText=e,C.addEventListener("click",n,r)},r);window.addEventListener("load",function(t){const e=new Image;e.src="lime/lime.cgi?mountain",e.width=1,e.height=1,C.parentNode.insertBefore(e,C)},r);window.addEventListener("beforeunload",function(t){const e=N(i.getCenter());s.lon=e[0].toFixed(6),s.lat=e[1].toFixed(6),s.zoom=i.getZoom();for(const n in s)localStorage.setItem(n,s[n])},r);
